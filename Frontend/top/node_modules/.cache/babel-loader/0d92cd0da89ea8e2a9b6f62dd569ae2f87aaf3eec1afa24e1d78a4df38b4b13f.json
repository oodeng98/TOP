{"ast":null,"code":"/**\n * dd-resizable-handle.ts 10.3.1\n * Copyright (c) 2021-2022 Alain Dumesny - see GridStack root license\n */\nimport { isTouch, pointerdown, touchend, touchmove, touchstart } from './dd-touch';\nclass DDResizableHandle {\n  constructor(host, dir, option) {\n    this.host = host;\n    this.dir = dir;\n    this.option = option;\n    /** @internal true after we've moved enough pixels to start a resize */\n    this.moving = false;\n    // create var event binding so we can easily remove and still look like TS methods (unlike anonymous functions)\n    this._mouseDown = this._mouseDown.bind(this);\n    this._mouseMove = this._mouseMove.bind(this);\n    this._mouseUp = this._mouseUp.bind(this);\n    this._keyEvent = this._keyEvent.bind(this);\n    this._init();\n  }\n  /** @internal */\n  _init() {\n    const el = this.el = document.createElement('div');\n    el.classList.add('ui-resizable-handle');\n    el.classList.add(`${DDResizableHandle.prefix}${this.dir}`);\n    el.style.zIndex = '100';\n    el.style.userSelect = 'none';\n    this.host.appendChild(this.el);\n    this.el.addEventListener('mousedown', this._mouseDown);\n    if (isTouch) {\n      this.el.addEventListener('touchstart', touchstart);\n      this.el.addEventListener('pointerdown', pointerdown);\n      // this.el.style.touchAction = 'none'; // not needed unlike pointerdown doc comment\n    }\n    return this;\n  }\n  /** call this when resize handle needs to be removed and cleaned up */\n  destroy() {\n    if (this.moving) this._mouseUp(this.mouseDownEvent);\n    this.el.removeEventListener('mousedown', this._mouseDown);\n    if (isTouch) {\n      this.el.removeEventListener('touchstart', touchstart);\n      this.el.removeEventListener('pointerdown', pointerdown);\n    }\n    this.host.removeChild(this.el);\n    delete this.el;\n    delete this.host;\n    return this;\n  }\n  /** @internal called on mouse down on us: capture move on the entire document (mouse might not stay on us) until we release the mouse */\n  _mouseDown(e) {\n    this.mouseDownEvent = e;\n    document.addEventListener('mousemove', this._mouseMove, {\n      capture: true,\n      passive: true\n    }); // capture, not bubble\n    document.addEventListener('mouseup', this._mouseUp, true);\n    if (isTouch) {\n      this.el.addEventListener('touchmove', touchmove);\n      this.el.addEventListener('touchend', touchend);\n    }\n    e.stopPropagation();\n    e.preventDefault();\n  }\n  /** @internal */\n  _mouseMove(e) {\n    let s = this.mouseDownEvent;\n    if (this.moving) {\n      this._triggerEvent('move', e);\n    } else if (Math.abs(e.x - s.x) + Math.abs(e.y - s.y) > 2) {\n      // don't start unless we've moved at least 3 pixels\n      this.moving = true;\n      this._triggerEvent('start', this.mouseDownEvent);\n      this._triggerEvent('move', e);\n      // now track keyboard events to cancel\n      document.addEventListener('keydown', this._keyEvent);\n    }\n    e.stopPropagation();\n    // e.preventDefault(); passive = true\n  }\n  /** @internal */\n  _mouseUp(e) {\n    if (this.moving) {\n      this._triggerEvent('stop', e);\n      document.removeEventListener('keydown', this._keyEvent);\n    }\n    document.removeEventListener('mousemove', this._mouseMove, true);\n    document.removeEventListener('mouseup', this._mouseUp, true);\n    if (isTouch) {\n      this.el.removeEventListener('touchmove', touchmove);\n      this.el.removeEventListener('touchend', touchend);\n    }\n    delete this.moving;\n    delete this.mouseDownEvent;\n    e.stopPropagation();\n    e.preventDefault();\n  }\n  /** @internal call when keys are being pressed - use Esc to cancel */\n  _keyEvent(e) {\n    if (e.key === 'Escape') {\n      this.host.gridstackNode?.grid?.engine.restoreInitial();\n      this._mouseUp(this.mouseDownEvent);\n    }\n  }\n  /** @internal */\n  _triggerEvent(name, event) {\n    if (this.option[name]) this.option[name](event);\n    return this;\n  }\n}\n/** @internal */\nDDResizableHandle.prefix = 'ui-resizable-';\nexport { DDResizableHandle };","map":{"version":3,"names":["isTouch","pointerdown","touchend","touchmove","touchstart","DDResizableHandle","constructor","host","dir","option","moving","_mouseDown","bind","_mouseMove","_mouseUp","_keyEvent","_init","el","document","createElement","classList","add","prefix","style","zIndex","userSelect","appendChild","addEventListener","destroy","mouseDownEvent","removeEventListener","removeChild","e","capture","passive","stopPropagation","preventDefault","s","_triggerEvent","Math","abs","x","y","key","gridstackNode","grid","engine","restoreInitial","name","event"],"sources":["../src/dd-resizable-handle.ts"],"sourcesContent":["/**\n * dd-resizable-handle.ts 10.3.1\n * Copyright (c) 2021-2022 Alain Dumesny - see GridStack root license\n */\n\nimport { isTouch, pointerdown, touchend, touchmove, touchstart } from './dd-touch';\nimport { GridItemHTMLElement } from './gridstack';\n\nexport interface DDResizableHandleOpt {\n  start?: (event) => void;\n  move?: (event) => void;\n  stop?: (event) => void;\n}\n\nexport class DDResizableHandle {\n  /** @internal */\n  protected el: HTMLElement;\n  /** @internal true after we've moved enough pixels to start a resize */\n  protected moving = false;\n  /** @internal */\n  protected mouseDownEvent: MouseEvent;\n  /** @internal */\n  protected static prefix = 'ui-resizable-';\n\n  constructor(protected host: GridItemHTMLElement, protected dir: string, protected option: DDResizableHandleOpt) {\n    // create var event binding so we can easily remove and still look like TS methods (unlike anonymous functions)\n    this._mouseDown = this._mouseDown.bind(this);\n    this._mouseMove = this._mouseMove.bind(this);\n    this._mouseUp = this._mouseUp.bind(this);\n    this._keyEvent = this._keyEvent.bind(this);\n\n    this._init();\n  }\n\n  /** @internal */\n  protected _init(): DDResizableHandle {\n    const el = this.el = document.createElement('div');\n    el.classList.add('ui-resizable-handle');\n    el.classList.add(`${DDResizableHandle.prefix}${this.dir}`);\n    el.style.zIndex = '100';\n    el.style.userSelect = 'none';\n    this.host.appendChild(this.el);\n    this.el.addEventListener('mousedown', this._mouseDown);\n    if (isTouch) {\n      this.el.addEventListener('touchstart', touchstart);\n      this.el.addEventListener('pointerdown', pointerdown);\n      // this.el.style.touchAction = 'none'; // not needed unlike pointerdown doc comment\n    }\n    return this;\n  }\n\n  /** call this when resize handle needs to be removed and cleaned up */\n  public destroy(): DDResizableHandle {\n    if (this.moving) this._mouseUp(this.mouseDownEvent);\n    this.el.removeEventListener('mousedown', this._mouseDown);\n    if (isTouch) {\n      this.el.removeEventListener('touchstart', touchstart);\n      this.el.removeEventListener('pointerdown', pointerdown);\n    }\n    this.host.removeChild(this.el);\n    delete this.el;\n    delete this.host;\n    return this;\n  }\n\n  /** @internal called on mouse down on us: capture move on the entire document (mouse might not stay on us) until we release the mouse */\n  protected _mouseDown(e: MouseEvent): void {\n    this.mouseDownEvent = e;\n    document.addEventListener('mousemove', this._mouseMove, { capture: true, passive: true}); // capture, not bubble\n    document.addEventListener('mouseup', this._mouseUp, true);\n    if (isTouch) {\n      this.el.addEventListener('touchmove', touchmove);\n      this.el.addEventListener('touchend', touchend);\n    }\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  /** @internal */\n  protected _mouseMove(e: MouseEvent): void {\n    let s = this.mouseDownEvent;\n    if (this.moving) {\n      this._triggerEvent('move', e);\n    } else if (Math.abs(e.x - s.x) + Math.abs(e.y - s.y) > 2) {\n      // don't start unless we've moved at least 3 pixels\n      this.moving = true;\n      this._triggerEvent('start', this.mouseDownEvent);\n      this._triggerEvent('move', e);\n      // now track keyboard events to cancel\n      document.addEventListener('keydown', this._keyEvent);\n    }\n    e.stopPropagation();\n    // e.preventDefault(); passive = true\n  }\n\n  /** @internal */\n  protected _mouseUp(e: MouseEvent): void {\n    if (this.moving) {\n      this._triggerEvent('stop', e);\n      document.removeEventListener('keydown', this._keyEvent);\n    }\n    document.removeEventListener('mousemove', this._mouseMove, true);\n    document.removeEventListener('mouseup', this._mouseUp, true);\n    if (isTouch) {\n      this.el.removeEventListener('touchmove', touchmove);\n      this.el.removeEventListener('touchend', touchend);\n    }\n    delete this.moving;\n    delete this.mouseDownEvent;\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  /** @internal call when keys are being pressed - use Esc to cancel */\n  protected _keyEvent(e: KeyboardEvent): void {\n    if (e.key === 'Escape') {\n      this.host.gridstackNode?.grid?.engine.restoreInitial();\n      this._mouseUp(this.mouseDownEvent);\n    }\n  }\n    \n  \n  \n  /** @internal */\n  protected _triggerEvent(name: string, event: MouseEvent): DDResizableHandle {\n    if (this.option[name]) this.option[name](event);\n    return this;\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}